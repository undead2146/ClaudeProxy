<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claude Code Proxy Dashboard</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
.container { max-width: 1400px; margin: 0 auto; }
h1 { color: #333; margin-bottom: 30px; font-size: 28px; }
.card { background: white; border-radius: 8px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
h2 { font-size: 20px; color: #333; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
.status-item { padding: 15px; background: #f9f9f9; border-radius: 6px; border-left: 4px solid #ddd; }
.status-item.available { border-left-color: #4CAF50; }
.status-item.unavailable { border-left-color: #f44336; }
.status-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
.status-value { font-size: 16px; font-weight: 600; color: #333; }
.tier-row { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
.tier-label { font-weight: 600; min-width: 80px; color: #555; }
select { padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; min-width: 180px; background: white; cursor: pointer; transition: all 0.2s; }
select:hover { border-color: #4CAF50; }
select:focus { outline: none; border-color: #4CAF50; box-shadow: 0 0 0 3px rgba(76,175,80,0.1); }
.arrow { color: #999; font-weight: bold; font-size: 18px; }
button { background: #4CAF50; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 10px; }
button:hover { background: #45a049; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
button:active { transform: translateY(0); }
button.secondary { background: #2196F3; margin-left: 10px; }
button.danger { background: #f44336; }
#message { margin-top: 15px; padding: 12px; border-radius: 6px; font-weight: 500; display: none; }
#message.success { background: #e8f5e9; color: #2e7d32; display: block; }
#message.error { background: #ffebee; color: #c62828; display: block; }
.logs-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.logs-header h2 { margin: 0; border: none; padding: 0; }
.log-controls { display: flex; gap: 10px; }
#logs { background: #0d1117; color: #c9d1d9; padding: 20px; border-radius: 6px; font-family: "Consolas", "Monaco", monospace; font-size: 13px; line-height: 1.6; max-height: 500px; overflow-y: auto; border: 1px solid #30363d; }
.log-entry { margin-bottom: 10px; padding: 10px; border-left: 3px solid #444; background: rgba(255,255,255,0.03); border-radius: 4px; }
.log-time { color: #8b949e; font-weight: 600; margin-right: 10px; }
.log-level { font-weight: bold; margin-right: 10px; padding: 2px 6px; border-radius: 3px; font-size: 11px; }
.log-level.INFO { color: #58a6ff; background: rgba(88,166,255,0.15); }
.log-level.WARNING { color: #f0883e; background: rgba(240,136,62,0.15); }
.log-level.ERROR { color: #f85149; background: rgba(248,81,73,0.15); }
.log-level.DEBUG { color: #a371f7; background: rgba(163,113,247,0.15); }
.empty-state { text-align: center; color: #8b949e; padding: 40px; font-style: italic; }
</style>
</head>
<body>
<div class="container">
<h1>Claude Code Proxy Dashboard</h1>

<div class="card">
<h2>Provider Availability</h2>
<div class="grid" id="providerStatus">
<div class="status-item"><div class="status-label">Loading...</div></div>
</div>
</div>

<div class="card">
<h2>Routing Configuration</h2>
<p style="color: #666; margin-bottom: 20px;">Select provider and model for each tier. Changes apply immediately without restart.</p>

<div class="tier-row">
<span class="tier-label">Sonnet</span>
<select id="sonnet_provider">
<option value="antigravity">Antigravity</option>
<option value="glm">GLM</option>
<option value="anthropic">Anthropic</option>
<option value="copilot">GitHub Copilot</option>
</select>
<span class="arrow">→</span>
<select id="sonnet_model"></select>
</div>

<div class="tier-row">
<span class="tier-label">Haiku</span>
<select id="haiku_provider">
<option value="antigravity">Antigravity</option>
<option value="glm">GLM</option>
<option value="anthropic">Anthropic</option>
<option value="copilot">GitHub Copilot</option>
</select>
<span class="arrow">→</span>
<select id="haiku_model"></select>
</div>

<div class="tier-row">
<span class="tier-label">Opus</span>
<select id="opus_provider">
<option value="antigravity">Antigravity</option>
<option value="glm">GLM</option>
<option value="anthropic">Anthropic</option>
<option value="copilot">GitHub Copilot</option>
</select>
<span class="arrow">→</span>
<select id="opus_model"></select>
</div>

<button onclick="applyConfig()">Apply Changes</button>
<div id="message"></div>
</div>

<div class="card">
<h2>Logs</h2>
<p style="margin: 10px 0; color: #8b949e;">View logs on a separate page for better readability</p>
<button onclick="window.location.href='/logs.html'" style="width: 100%;">Open Logs Page</button>
</div>
</div>

<script>
let config = {};
let availableModels = {};
let providersAvailable = {};

async function loadConfig() {
try {
const response = await fetch('/config');
const data = await response.json();
config = data.config;
availableModels = data.available_models;
providersAvailable = data.providers_available;

document.getElementById('sonnet_provider').value = config.sonnet_provider;
document.getElementById('haiku_provider').value = config.haiku_provider;
document.getElementById('opus_provider').value = config.opus_provider;

populateModelDropdown('sonnet', config.sonnet_provider, config.sonnet_model);
populateModelDropdown('haiku', config.haiku_provider, config.haiku_model);
populateModelDropdown('opus', config.opus_provider, config.opus_model);

document.getElementById('sonnet_provider').onchange = (e) => populateModelDropdown('sonnet', e.target.value);
document.getElementById('haiku_provider').onchange = (e) => populateModelDropdown('haiku', e.target.value);
document.getElementById('opus_provider').onchange = (e) => populateModelDropdown('opus', e.target.value);

updateProviderStatus();
} catch (error) {
console.error('Failed to load config:', error);
showMessage('Failed to load configuration: ' + error.message, 'error');
}
}

function populateModelDropdown(tier, provider, selectedModel) {
const select = document.getElementById(tier + '_model');
const models = availableModels[provider] || [];
select.innerHTML = '';
models.forEach(model => {
const option = document.createElement('option');
option.value = model;
option.textContent = model;
select.appendChild(option);
});
if (selectedModel && models.includes(selectedModel)) {
select.value = selectedModel;
} else if (models.length > 0) {
select.value = models[0];
}
}

function updateProviderStatus() {
const div = document.getElementById('providerStatus');
const providers = [
{ name: 'Antigravity', key: 'antigravity' },
{ name: 'GLM', key: 'glm' },
{ name: 'Anthropic', key: 'anthropic' },
{ name: 'GitHub Copilot', key: 'copilot' }
];
div.innerHTML = providers.map(p => {
const available = providersAvailable[p.key];
const statusClass = available ? 'available' : 'unavailable';
const statusText = available ? 'Available' : 'Not Configured';
return '<div class="status-item ' + statusClass + '"><div class="status-label">' + p.name + '</div><div class="status-value">' + statusText + '</div></div>';
}).join('');
}

async function applyConfig() {
const button = event.target;
button.disabled = true;
button.textContent = 'Applying...';

const updates = {
sonnet_provider: document.getElementById('sonnet_provider').value,
haiku_provider: document.getElementById('haiku_provider').value,
opus_provider: document.getElementById('opus_provider').value,
sonnet_model: document.getElementById('sonnet_model').value,
haiku_model: document.getElementById('haiku_model').value,
opus_model: document.getElementById('opus_model').value
};

try {
const response = await fetch('/config', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(updates)
});
const data = await response.json();
if (response.ok) {
config = data.config;
showMessage('Configuration updated successfully!', 'success');
} else {
showMessage('Error: ' + (data.error || 'Unknown error'), 'error');
}
} catch (error) {
showMessage('Failed to update: ' + error.message, 'error');
} finally {
button.disabled = false;
button.textContent = 'Apply Changes';
}
}

function showMessage(text, type) {
const msgDiv = document.getElementById('message');
msgDiv.textContent = text;
msgDiv.className = type;
setTimeout(() => { msgDiv.style.display = 'none'; }, 5000);
}

loadConfig();
setInterval(loadConfig, 10000);
</script>
</body>
</html>
